package com.chengxin.fragment;import android.content.BroadcastReceiver;import android.content.Context;import android.content.Intent;import android.content.IntentFilter;import android.graphics.Color;import android.os.Bundle;import android.support.v4.app.Fragment;import android.view.LayoutInflater;import android.view.View;import android.view.View.OnClickListener;import android.view.ViewGroup;import android.widget.Button;import android.widget.LinearLayout;import android.widget.RelativeLayout;import android.widget.TextView;import com.chengxin.R;import com.chengxin.ShoppingCartActivity;import com.chengxin.global.GlobalParam;import com.chengxin.global.WeiYuanCommon;public class ShopCityFragment extends Fragment implements OnClickListener {	private Context mContext;	private View view;	private LinearLayout mLayoutGoods;	private Button mButtonGoods;	private Button mButtonShop;	private TextView mButtonNotice;	private LinearLayout mLayoutShop;	private RelativeLayout mBuyBtn;	private TextView mGoodsCountTextView;	private GoodsListFragment goodsListFragment;	private MerchantFragment shopListFragment;	private int currPage;	@Override	public void onActivityCreated(Bundle savedInstanceState) {		super.onActivityCreated(savedInstanceState);		IntentFilter filter = new IntentFilter();		filter.addAction(GlobalParam.ACTION_REFRESH_MERCHANT_GOODS_COUNT);		mContext.registerReceiver(mRefreshReceiver, filter);		mBuyBtn = (RelativeLayout) view.findViewById(R.id.buy_btn);		mBuyBtn.setOnClickListener(this);		mGoodsCountTextView = (TextView) view.findViewById(R.id.shpping_number);		mGoodsCountTextView.setText(WeiYuanCommon.getGoodsCount() + "");		mLayoutGoods = (LinearLayout) view.findViewById(R.id.product_layout);		mLayoutShop = (LinearLayout) view.findViewById(R.id.shop_layout);		goodsListFragment = (GoodsListFragment) getFragmentManager()				.findFragmentById(R.id.goods_list_fragment);		shopListFragment = (MerchantFragment) getFragmentManager()				.findFragmentById(R.id.shop_goods_fragment);		mButtonGoods = (Button) view.findViewById(R.id.btn_goods);		mButtonShop = (Button) view.findViewById(R.id.btn_shop);		mButtonNotice = (TextView) view.findViewById(R.id.btn_notice);		mButtonGoods.setOnClickListener(this);		mButtonShop.setOnClickListener(this);		mButtonNotice.setOnClickListener(this);	}	@Override	public void onCreate(Bundle savedInstanceState) {		super.onCreate(savedInstanceState);		mContext = ShopCityFragment.this.getActivity();	}	@Override	public View onCreateView(LayoutInflater inflater, ViewGroup container,			Bundle savedInstanceState) {		view = inflater.inflate(R.layout.shop_city_fragment, container, false);		return view;	}	@Override	public void onDestroy() {		super.onDestroy();		System.gc();		if (mRefreshReceiver != null) {			mContext.unregisterReceiver(mRefreshReceiver);		}	}	@Override	public void onDestroyView() {		super.onDestroyView();		// 内嵌的Fragment GoodsListFragment		if (goodsListFragment != null) {			getFragmentManager().beginTransaction().remove(goodsListFragment)					.commit();		}		// 内嵌的Fragment MerchantFragment		if (shopListFragment != null) {			getFragmentManager().beginTransaction().remove(shopListFragment)					.commit();		}	}	@Override	public void onClick(View v) {		switch (v.getId()) {		case R.id.buy_btn:			Intent cartIntent = new Intent();			cartIntent.setClass(mContext, ShoppingCartActivity.class);			startActivity(cartIntent);			break;		case R.id.btn_goods:			currPage = 0;			mLayoutGoods.setVisibility(View.VISIBLE);			mLayoutShop.setVisibility(View.GONE);			mButtonGoods.setBackgroundResource(R.color.application_blue);			mButtonShop.setBackgroundResource(R.color.application_gray_black);			mButtonGoods.setTextColor(Color.parseColor("#ffffff"));			mButtonShop.setTextColor(Color.parseColor("#010101"));			break;		case R.id.btn_shop:			currPage = 1;			mLayoutShop.setVisibility(View.VISIBLE);			mLayoutGoods.setVisibility(View.GONE);			mButtonShop.setBackgroundResource(R.color.application_blue);			mButtonGoods.setBackgroundResource(R.color.application_gray_black);			mButtonShop.setTextColor(Color.parseColor("#ffffff"));			mButtonGoods.setTextColor(Color.parseColor("#010101"));			break;		case R.id.btn_notice:			break;		default:			break;		}	}	private BroadcastReceiver mRefreshReceiver = new BroadcastReceiver() {		@Override		public void onReceive(Context context, Intent intent) {			if (intent == null					|| (intent.getAction() == null || intent.getAction()							.equals(""))) {				return;			}			String action = intent.getAction();			if (action.equals(GlobalParam.ACTION_REFRESH_MERCHANT_GOODS_COUNT)) {				mGoodsCountTextView.setText(WeiYuanCommon.getGoodsCount() + "");			}		}	};	public void startSearch() {		switch (currPage) {		case 0:			goodsListFragment.startSearch();			break;		case 1:			shopListFragment.startSearch();			break;		default:			break;		}	}}