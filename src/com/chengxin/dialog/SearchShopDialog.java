package com.chengxin.dialog;import java.util.ArrayList;import java.util.List;import android.app.Dialog;import android.content.Context;import android.content.Intent;import android.os.Bundle;import android.os.Handler;import android.os.Message;import android.text.Editable;import android.text.TextWatcher;import android.view.MotionEvent;import android.view.View;import android.view.inputmethod.InputMethodManager;import android.widget.Button;import android.widget.EditText;import android.widget.ListView;import android.widget.Toast;import com.chengxin.ChatMainActivity;import com.chengxin.R;import com.chengxin.Entity.Login;import com.chengxin.Entity.LoginResult;import com.chengxin.Entity.Merchant;import com.chengxin.adapter.MerchantAdapter;import com.chengxin.global.GlobalParam;public class SearchShopDialog extends Dialog implements		android.view.View.OnClickListener {	private List<Merchant> mSourceList;	private List<Merchant> mSearchList;	private List<Integer> mListPos;	private Context mContext;	private Button mCancleBtn;	private EditText mContentEdit;	protected ListView mListView;	MerchantAdapter mAdapter = null;	private int mShopType = 0;	public SearchShopDialog(Context context, List<Merchant> sourceList, int shopType) {		super(context, R.style.ContentOverlay);		mSourceList = sourceList;		mContext = context;		mShopType = shopType;	}	public SearchShopDialog(Context context) {		super(context, R.style.ContentOverlay);		mContext = context;	}	@Override	protected void onCreate(Bundle savedInstanceState) {		super.onCreate(savedInstanceState);		setContentView(R.layout.contact_search_dialog);		initComponent();	}	private void initComponent() {		mCancleBtn = (Button) findViewById(R.id.cancle_btn);		mCancleBtn.setOnClickListener(this);		mSearchList = new ArrayList<Merchant>();		mListPos = new ArrayList<Integer>();		mContentEdit = (EditText) findViewById(R.id.searchcontent);		mContentEdit.addTextChangedListener(new TextWatcher() {			@Override			public void onTextChanged(CharSequence s, int start, int before,					int count) {			}			@Override			public void beforeTextChanged(CharSequence s, int start, int count,					int after) {			}			@Override			public void afterTextChanged(Editable s) {				if (mSourceList == null || mSourceList.size() <= 0) {					return;				}				List<Merchant> tempList = new ArrayList<Merchant>();				List<Integer> indexList = new ArrayList<Integer>();				if (s.toString() != null && !s.toString().equals("")) {					for (int i = 0; i < mSourceList.size(); i++) {						String name = mSourceList.get(i).name;						String username = mSourceList.get(i).username;						String city = mSourceList.get(i).city;						String address = mSourceList.get(i).address;						String phone = mSourceList.get(i).phone;						if (name != null && !name.equals("")								&& name.contains(s.toString())) {							tempList.add(mSourceList.get(i));							indexList.add(new Integer(i));						} else if (username != null && !username.equals("")								&& username.contains(s.toString())) {							tempList.add(mSourceList.get(i));							indexList.add(new Integer(i));						} else if (city != null && !city.equals("")								&& city.contains(s.toString())) {							tempList.add(mSourceList.get(i));							indexList.add(new Integer(i));						} else if (address != null && !address.equals("")								&& address.contains(s.toString())) {							tempList.add(mSourceList.get(i));							indexList.add(new Integer(i));						}						if (phone != null && !phone.equals("")) {							if (phone.contains(s.toString())) {								tempList.add(mSourceList.get(i));								indexList.add(new Integer(i));							}						}					}				}				if (mSearchList != null) {					mSearchList.clear();				}				if (mListPos != null) {					mListPos.clear();				}				mSearchList.addAll(tempList);				mListPos.addAll(indexList);				updateListView();				if (mSearchList != null && mSearchList.size() > 0) {					mListView.setVisibility(View.VISIBLE);				} else {					mListView.setVisibility(View.GONE);				}			}		});		mListView = (ListView) findViewById(R.id.contact_list);		mListView.setVisibility(View.GONE);		mListView.setDivider(mContext.getResources().getDrawable(				R.drawable.order_devider_line));		mListView.setCacheColorHint(0);	}	private void updateListView() {		if (mSearchList != null && mSearchList.size() != 0) {			mListView.setVisibility(View.VISIBLE);		}		if (mAdapter != null) {			mAdapter.notifyDataSetChanged();			return;		} else if (mSearchList != null) {			mAdapter = new MerchantAdapter(mContext, mSearchList, mShopType );			mListView.setAdapter(mAdapter);		}	}	@Override	public void onClick(View v) {		SearchShopDialog.this.dismiss();	}	private void hideKeyBoard() {		if (getCurrentFocus() != null				&& getCurrentFocus().getWindowToken() != null) {			InputMethodManager manager = (InputMethodManager) mContext					.getSystemService(Context.INPUT_METHOD_SERVICE);			manager.hideSoftInputFromWindow(getCurrentFocus().getWindowToken(),					InputMethodManager.HIDE_NOT_ALWAYS);		}	}	@Override	public boolean onTouchEvent(MotionEvent event) {		if (event.getAction() == MotionEvent.ACTION_DOWN) {			if (mSearchList == null || mSearchList.size() <= 0) {				hideKeyBoard();				SearchShopDialog.this.dismiss();			}		}		return super.onTouchEvent(event);	}	protected Handler mHandler = new Handler() {		@Override		public void handleMessage(Message msg) {			super.handleMessage(msg);			switch (msg.what) {			case GlobalParam.MSG_GET_CONTACT_DATA:				LoginResult login = (LoginResult) msg.obj;				if (login == null) {					Toast.makeText(mContext, R.string.commit_data_error,							Toast.LENGTH_LONG).show();					return;				}				if (login.mState.code == 0) {					Login user = login.mLogin;					if (user != null) {						Intent intent = new Intent(mContext,								ChatMainActivity.class);						user.mIsRoom = 100;						intent.putExtra("data", user);						mContext.startActivity(intent);						SearchShopDialog.this.dismiss();					}				} else {					Toast.makeText(mContext, login.mState.errorMsg,							Toast.LENGTH_LONG).show();				}				break;			default:				break;			}		}	};}