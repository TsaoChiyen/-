package com.chengxin.profile.shopping;import java.util.ArrayList;import java.util.List;import android.content.Intent;import android.os.Bundle;import android.os.Handler;import android.os.Message;import android.view.View;import android.widget.EditText;import android.widget.TextView;import android.widget.ImageView;import android.widget.Toast;import com.chengxin.R;import com.chengxin.BaseActivity;import com.chengxin.Entity.Goods;import com.chengxin.Entity.WeiYuanState;import com.chengxin.global.GlobalParam;import com.chengxin.global.ImageLoader;import com.chengxin.global.WeiYuanCommon;import com.chengxin.net.WeiYuanException;public class ShopShelfInfoActivity extends BaseActivity {	private Goods mGoods;	private int mPosition;	private EditText mPriceEdit;	private EditText mNumberEdit;	private TextView mGoodsName;	private ImageView mImageIcon;	private ImageLoader mImageLoader = new ImageLoader();	private String mGoodsId;	private String mGoodsPrice;	private String mGoodsNumber;	private Handler mHandler = new Handler() {		@Override		public void handleMessage(Message msg) {			super.handleMessage(msg);			switch (msg.what) {			case GlobalParam.MSG_CHECK_STATE:				WeiYuanState state = (WeiYuanState) msg.obj;				if (state == null) {					Toast.makeText(mContext, R.string.commit_data_error,							Toast.LENGTH_LONG).show();					return;				}				if (state.code == 0) {					Intent intent = new Intent();					intent.putExtra("data", mGoods);					intent.putExtra("position", mPosition);					ShopShelfInfoActivity.this.setResult(RESULT_OK, intent);					ShopShelfInfoActivity.this.finish();				} else {					Toast.makeText(mContext, state.errorMsg, Toast.LENGTH_LONG)							.show();				}				break;			default:				break;			}		}	};	@Override	protected void onCreate(Bundle savedInstanceState) {		super.onCreate(savedInstanceState);		mContext = this;		setContentView(R.layout.shop_shelf_info);		initComponent();	}	private void initComponent() {		setTitleContent(R.drawable.back_btn, R.drawable.ok, R.string.shop_shelf_info_title);        mLeftBtn.setOnClickListener(this);        mRightBtn.setOnClickListener(this);                mGoods = (Goods)getIntent().getExtras().get("data");        mPosition = getIntent().getIntExtra("position", -1);        mGoodsName = (TextView)findViewById(R.id.goods_name);        mImageIcon = (ImageView)findViewById(R.id.goods_icon);                mPriceEdit = (EditText)findViewById(R.id.text_price);        mNumberEdit = (EditText)findViewById(R.id.text_number);        if (mGoods != null) {        	mGoodsName.setText(mGoods.name);        	mPriceEdit.setText(String.valueOf(mGoods.price));        	mNumberEdit.setText(String.valueOf(mGoods.number));        	        	if (mGoods.logo != null && mGoods.logo.equals("") && mGoods.logo.equals("null")) {        		mImageLoader.getBitmap(mContext, mImageIcon, null, mGoods.logo, 0, true, false);        	}        }	}	@Override	public void onClick(View v) {		super.onClick(v);		switch (v.getId()) {		case R.id.left_btn:			this.finish();			break;		case R.id.right_btn:			commit();			break;		default:			break;		}	}	private void commit() {		if (mGoods != null) {			mGoodsId = mGoods.id;			mGoodsPrice = mPriceEdit.getText().toString();			mGoodsNumber = mNumberEdit.getText().toString();			mGoods.price = Float.valueOf(mGoodsPrice);			mGoods.number = Integer.valueOf(mGoodsNumber);						if (!WeiYuanCommon.getNetWorkState()) {				mBaseHandler.sendEmptyMessage(BASE_MSG_NETWORK_ERROR);				return;			}						new Thread(){				public void run() {					try {						WeiYuanCommon.sendMsg(mBaseHandler, BASE_SHOW_PROGRESS_DIALOG, 								mContext.getResources().getString(R.string.send_request));						WeiYuanState state = WeiYuanCommon.getWeiYuanInfo().editShelfGoods(								mGoodsId,								mGoodsPrice,								mGoodsNumber);						mBaseHandler.sendEmptyMessage(BASE_HIDE_PROGRESS_DIALOG);						WeiYuanCommon.sendMsg(mHandler, GlobalParam.MSG_CHECK_STATE, state);					} catch (WeiYuanException e) {						e.printStackTrace();						WeiYuanCommon.sendMsg(mBaseHandler, BASE_MSG_TIMEOUT_ERROR, 								mContext.getResources().getString(e.getStatusCode()));					}catch (Exception e) {						e.printStackTrace();						mBaseHandler.sendEmptyMessage(BASE_HIDE_PROGRESS_DIALOG);					}				};			}.start();					}	}}