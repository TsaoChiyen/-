package com.chengxin.profile.shopping;import android.content.Intent;import android.content.res.Resources.NotFoundException;import android.os.Bundle;import android.os.Handler;import android.os.Message;import android.view.View;import android.widget.EditText;import android.widget.Toast;import com.chengxin.R;import com.chengxin.BaseActivity;import com.chengxin.Entity.ShopService;import com.chengxin.Entity.WeiYuanState;import com.chengxin.global.GlobalParam;import com.chengxin.global.WeiYuanCommon;import com.chengxin.net.WeiYuanException;public class AddShopServiceActivity extends BaseActivity {	private EditText mInputServiceName;	private EditText mInputServiceUid;	private int mPosition;	private String mServiceName;	private String mServiceUid;	@Override	protected void onCreate(Bundle savedInstanceState) {		super.onCreate(savedInstanceState);		mContext = this;		setContentView(R.layout.add_shop_service);		initComponent();	}	private void initComponent() {		setTitleContent(R.drawable.back_btn, R.drawable.ok, R.string.bank_edit_title);		mLeftBtn.setOnClickListener(this);		mRightBtn.setOnClickListener(this);		mInputServiceName = (EditText)findViewById(R.id.service_name);		mInputServiceUid = (EditText)findViewById(R.id.service_uid);				mPosition = getIntent().getIntExtra("pos", 0);	}	@Override	public void onClick(View v) {		super.onClick(v);				switch (v.getId()) {		case R.id.left_btn:			this.finish();			break;		case R.id.right_btn:			commit();			break;		default:			break;		}	}	private void commit() {		if (!verifyValue()) return;		if(!WeiYuanCommon.getNetWorkState()){			mBaseHandler.sendEmptyMessage(BASE_MSG_NETWORK_ERROR);			return;		}				new Thread(){			public void run() {				try {					WeiYuanCommon.sendMsg(mBaseHandler, BASE_SHOW_PROGRESS_DIALOG, 							mContext.getResources().getString(R.string.commit_dataing));					WeiYuanState state = WeiYuanCommon.getWeiYuanInfo().addServiceOfShop(							mServiceName,							mServiceUid);										mBaseHandler.sendEmptyMessage(BASE_HIDE_PROGRESS_DIALOG);					WeiYuanCommon.sendMsg(mHandler, GlobalParam.MSG_CHECK_STATE, state);				} catch (NotFoundException e) {					e.printStackTrace();					mBaseHandler.sendEmptyMessage(BASE_HIDE_PROGRESS_DIALOG);				} catch (WeiYuanException e) {					e.printStackTrace();					WeiYuanCommon.sendMsg(mBaseHandler, BASE_MSG_TIMEOUT_ERROR, 							mContext.getResources().getString(e.getStatusCode()));				} catch (Exception e) {					e.printStackTrace();					mBaseHandler.sendEmptyMessage(BASE_HIDE_PROGRESS_DIALOG);				}			};		}.start();	}	private boolean verifyValue() {		mServiceName = mInputServiceName.getText().toString();		mServiceUid = mInputServiceUid.getText().toString();				boolean isCheck = true;		String hintMsg = "";				if (mServiceName == null || mServiceName.equals("")) {			isCheck = false;			hintMsg = "请输入客服名称";		} else if (mServiceUid == null || mServiceUid.equals("")) {			isCheck = false;			hintMsg = "请输入客服账号（已注册的手机号码）";		}		if(!isCheck && (hintMsg != null && !hintMsg.equals(""))){			Toast.makeText(mContext, hintMsg, Toast.LENGTH_LONG).show();		}		return isCheck;	}	protected Handler mHandler = new Handler(){		@Override		public void handleMessage(Message msg) {			super.handleMessage(msg);						switch (msg.what) {			case GlobalParam.MSG_CHECK_STATE:				WeiYuanState state = (WeiYuanState)msg.obj;								if(state == null){					Toast.makeText(mContext, R.string.commit_data_error,Toast.LENGTH_LONG).show();					return;				}								Toast.makeText(mContext, state.errorMsg,Toast.LENGTH_LONG).show();				if(state.code == 0){					Intent intent = new Intent();					intent.putExtra("pos", mPosition);					ShopService service = new ShopService();					service.name = mServiceName;					service.username = mServiceUid;					intent.putExtra("service", service);					setResult(RESULT_OK,intent);					AddShopServiceActivity.this.finish();				}								break;			default:				break;			}		}	};}