package com.chengxin.financial;import android.content.Intent;import android.net.Uri;import android.os.Bundle;import android.os.Handler;import android.os.Message;import android.view.LayoutInflater;import android.view.View;import android.widget.ImageView;import android.widget.LinearLayout;import android.widget.ProgressBar;import android.widget.TextView;import android.widget.Toast;import com.chengxin.BaseActivity;import com.chengxin.ChatMainActivity;import com.chengxin.R;import com.chengxin.Entity.Financier;import com.chengxin.Entity.FinancingGoods;import com.chengxin.Entity.FinancingGoodsList;import com.chengxin.Entity.Login;import com.chengxin.Entity.LoginResult;import com.chengxin.Entity.WeiYuanState;import com.chengxin.global.GlobalParam;import com.chengxin.global.ImageLoader;import com.chengxin.global.WeiYuanCommon;import com.chengxin.map.BMapApiApp;import com.chengxin.net.WeiYuanException;public class FinancGoodsDetialActivity extends BaseActivity {	private FinancingGoods mGoods;	private TextView btnChat;	private TextView btnCall;	private ImageView imageIcon;	private TextView textName;	private TextView textType;	private TextView textLimit;	private TextView textMonths;	private TextView textLoan;	private TextView textRepay;	private TextView textMonthly;	private TextView textTotalprice;	private TextView textCondition;	private TextView textClienttype;	private TextView textMaterial;	private ImageLoader imageLoader = new ImageLoader();	private LinearLayout layoutClientType;	private LinearLayout layoutCondition;	private LinearLayout layoutMaterial;	private TextView textOther;	private LinearLayout layoutOther;	@Override	protected void onCreate(Bundle savedInstanceState) {		super.onCreate(savedInstanceState);		mContext = this;		setContentView(R.layout.activity_financ_goods_detail);				initComponent();		getData();	}	private void initComponent() {		setTitleContent(R.drawable.back_btn, 0, "融资产品详情");		mLeftBtn.setOnClickListener(this);				btnChat = (TextView)findViewById(R.id.btn_chat);		btnCall = (TextView)findViewById(R.id.btn_call);		imageIcon = (ImageView)findViewById(R.id.image_icon);		textName = (TextView)findViewById(R.id.text_name);		textType = (TextView)findViewById(R.id.text_type);		textLimit = (TextView)findViewById(R.id.text_limit);		textMonths = (TextView)findViewById(R.id.text_months);		textLoan = (TextView)findViewById(R.id.text_loan);		textRepay = (TextView)findViewById(R.id.text_repay);		textMonthly = (TextView)findViewById(R.id.text_monthly);		textTotalprice = (TextView)findViewById(R.id.text_totalprice);		textClienttype = (TextView)findViewById(R.id.text_clienttype);		textCondition = (TextView)findViewById(R.id.text_condition);		textMaterial = (TextView)findViewById(R.id.text_material);		textOther = (TextView)findViewById(R.id.text_other);				layoutClientType = (LinearLayout)findViewById(R.id.layout_clienttype);		layoutCondition = (LinearLayout)findViewById(R.id.layout_condition);		layoutMaterial = (LinearLayout)findViewById(R.id.layout_material);		layoutOther = (LinearLayout)findViewById(R.id.layout_other);				btnChat.setOnClickListener(this);		btnCall.setOnClickListener(this);	}	private void getData() {		if (getIntent().hasExtra("data")) {			mGoods = (FinancingGoods)getIntent().getExtras().get("data");		}		if (mGoods != null) {			if (mGoods.headsmall != null && mGoods.headsmall.length() > 4) {				imageLoader.getBitmap(mContext, imageIcon, null, mGoods.headsmall, 0, false, false, false);			}			if (mGoods.name != null && !mGoods.name.equals("") && !mGoods.name.equals("null")) {				textName.setText(mGoods.name);			}			if (mGoods.type >= 0) {				textType.setText(mGoods.getTypeString());			}			if (mGoods.loanAmount != null && !mGoods.loanAmount.equals("") && !mGoods.loanAmount.equals("null")) {				textLimit.setText(mGoods.getLoanAmountString());			}						if (mGoods.loanPeriod != null && !mGoods.loanPeriod.equals("") && !mGoods.loanPeriod.equals("null")) {				textMonths.setText(mGoods.getLoanPeriodString());			}			textLoan.setText(mGoods.getLoanTimeString());			textRepay.setText(mGoods.getMonthRepayString());			textMonthly.setText(mGoods.getMonthlyString());			textTotalprice.setText(mGoods.getTotalPriceString());			String text = FinancingGoods.getListString(mGoods.clientType);						if (text != null && text.length() > 0) {				textClienttype.setText(text);			} else {				layoutClientType.setVisibility(View.GONE);			}						text = FinancingGoods.getListString(mGoods.loanTerms);						if (text != null && text.length() > 0) {				textCondition.setText(text);			} else {				layoutCondition.setVisibility(View.GONE);			}						text = FinancingGoods.getListString(mGoods.material);						if (text != null && text.length() > 0) {				textMaterial.setText(text);			} else {				layoutMaterial.setVisibility(View.GONE);			}			text = FinancingGoods.getListString(mGoods.other);						if (text != null && text.length() > 0) {				textOther.setText(text);			} else {				layoutOther.setVisibility(View.GONE);			}		}	}	@Override	public void onClick(View v) {		super.onClick(v);		switch (v.getId()) {		case R.id.left_btn:			goBack();			break;		case R.id.btn_chat:			beginChatWithUid(mGoods.uid);			break;		case R.id.btn_call:			Intent intent = new Intent(Intent.ACTION_CALL, Uri.parse("tel:" + mGoods.phone));			if (intent != null) startActivity(intent);			break;		}	}	private void goBack() {		setResult(RESULT_OK);		this.finish();	}		private void beginChatWithUid(final String uid) {		if (uid != null && !uid.equals("")) {			if (!WeiYuanCommon.getNetWorkState()) {				mBaseHandler.sendEmptyMessage(BASE_MSG_NETWORK_ERROR);				return;			}			new Thread(){				public void run() {					try {						LoginResult user = WeiYuanCommon.getWeiYuanInfo().getUserInfo(uid);						WeiYuanCommon.sendMsg(mHandler, GlobalParam.MSG_GET_CONTACT_DATA, user);					} catch (WeiYuanException e) {						e.printStackTrace();						WeiYuanCommon.sendMsg(mBaseHandler, BASE_MSG_TIMEOUT_ERROR, 								mContext.getResources().getString(e.getStatusCode()));					} catch (Exception e) {						e.printStackTrace();					}				};			}.start();		}	}		protected Handler mHandler = new Handler() {		@Override		public void handleMessage(Message msg) {			super.handleMessage(msg);						switch (msg.what) {			case GlobalParam.MSG_GET_CONTACT_DATA:				LoginResult login = (LoginResult)msg.obj;								if(login == null){					Toast.makeText(mContext, R.string.commit_data_error,Toast.LENGTH_LONG).show();					return;				}								if(login.mState.code == 0){					Login user = login.mLogin;										if(user != null){						Intent intent = new Intent(mContext, ChatMainActivity.class);						user.mIsRoom = 100;						intent.putExtra("data", user);						startActivity(intent);					}				} else {					Toast.makeText(mContext, login.mState.errorMsg,Toast.LENGTH_LONG).show();				}				break;			}		}	};}