package com.chengxin.market;import android.content.BroadcastReceiver;import android.content.Context;import android.content.Intent;import android.content.IntentFilter;import android.graphics.Color;import android.os.Bundle;import android.view.View;import android.view.View.OnClickListener;import android.widget.Button;import android.widget.LinearLayout;import android.widget.RelativeLayout;import android.widget.TextView;import com.chengxin.BaseActivity;import com.chengxin.R;import com.chengxin.ShoppingCartActivity;import com.chengxin.fragment.GoodsListFragment;import com.chengxin.fragment.MerchantFragment;import com.chengxin.global.GlobalParam;import com.chengxin.global.WeiYuanCommon;public class MarketMainActivity extends BaseActivity implements OnClickListener {	private LinearLayout mLayoutGoods;	private Button mButtonGoods;	private Button mButtonShop;	private TextView mButtonNotice;	private LinearLayout mLayoutShop;	private RelativeLayout mBuyBtn;	private TextView mGoodsCountTextView;	private GoodsListFragment goodsListFragment;	private MerchantFragment shopListFragment;	private int currPage;	@Override	protected void onCreate(Bundle savedInstanceState) {		super.onCreate(savedInstanceState);		mContext = this;		setContentView(R.layout.market_main_activity);		initComponent();	}	public void initComponent() {		setTitleContent(R.drawable.back_btn, true, false, false, R.string.market_main_title);		mLeftBtn.setOnClickListener(this);		mSearchBtn.setOnClickListener(this);		IntentFilter filter = new IntentFilter();		filter.addAction(GlobalParam.ACTION_REFRESH_MERCHANT_GOODS_COUNT);		mContext.registerReceiver(mRefreshReceiver, filter);		mBuyBtn = (RelativeLayout) findViewById(R.id.buy_btn);		mBuyBtn.setOnClickListener(this);		mGoodsCountTextView = (TextView) findViewById(R.id.shpping_number);		mGoodsCountTextView.setText(WeiYuanCommon.getGoodsCount() + "");		mLayoutGoods = (LinearLayout) findViewById(R.id.product_layout);		mLayoutShop = (LinearLayout) findViewById(R.id.shop_layout);		goodsListFragment = (GoodsListFragment) getSupportFragmentManager()				.findFragmentById(R.id.goods_list_fragment);		shopListFragment = (MerchantFragment) getSupportFragmentManager()				.findFragmentById(R.id.shop_goods_fragment);		goodsListFragment.setShopType(1);		shopListFragment.setShopType(1);				mButtonGoods = (Button) findViewById(R.id.btn_goods);		mButtonShop = (Button) findViewById(R.id.btn_shop);		mButtonNotice = (TextView) findViewById(R.id.btn_notice);		mButtonGoods.setOnClickListener(this);		mButtonShop.setOnClickListener(this);		mButtonNotice.setOnClickListener(this);	}	@Override	public void onDestroy() {		super.onDestroy();		System.gc();		if (mRefreshReceiver != null) {			mContext.unregisterReceiver(mRefreshReceiver);		}	}	@Override	public void onClick(View v) {		switch (v.getId()) {		case R.id.left_btn:			this.finish();			break;		case R.id.search_btn:			startSearch();			break;		case R.id.buy_btn:			Intent cartIntent = new Intent();			cartIntent.setClass(mContext, ShoppingCartActivity.class);			startActivity(cartIntent);			break;		case R.id.btn_goods:			currPage = 0;			mLayoutGoods.setVisibility(View.VISIBLE);			mLayoutShop.setVisibility(View.GONE);			mButtonGoods.setBackgroundResource(R.color.application_blue);			mButtonShop.setBackgroundResource(R.color.application_gray_black);			mButtonGoods.setTextColor(Color.parseColor("#ffffff"));			mButtonShop.setTextColor(Color.parseColor("#010101"));			break;		case R.id.btn_shop:			currPage = 1;			mLayoutShop.setVisibility(View.VISIBLE);			mLayoutGoods.setVisibility(View.GONE);			mButtonShop.setBackgroundResource(R.color.application_blue);			mButtonGoods.setBackgroundResource(R.color.application_gray_black);			mButtonShop.setTextColor(Color.parseColor("#ffffff"));			mButtonGoods.setTextColor(Color.parseColor("#010101"));			break;		case R.id.btn_notice:			break;		default:			break;		}	}	private BroadcastReceiver mRefreshReceiver = new BroadcastReceiver() {		@Override		public void onReceive(Context context, Intent intent) {			if (intent == null					|| (intent.getAction() == null || intent.getAction()							.equals(""))) {				return;			}			String action = intent.getAction();			if (action.equals(GlobalParam.ACTION_REFRESH_MERCHANT_GOODS_COUNT)) {				mGoodsCountTextView.setText(WeiYuanCommon.getGoodsCount() + "");			}		}	};	public void startSearch() {		switch (currPage) {		case 0:			goodsListFragment.startSearch();			break;		case 1:			shopListFragment.startSearch();			break;		default:			break;		}	}}